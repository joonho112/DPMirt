% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dp_measure.R
\name{dpmirt_dp_density}
\alias{dpmirt_dp_density}
\alias{print.dpmirt_dp_density}
\title{Compute posterior density of the DP mixture}
\usage{
dpmirt_dp_density(
  fit,
  grid = seq(-6, 6, length.out = 500),
  credible_interval = 0.95,
  apply_rescaling = TRUE,
  verbose = TRUE,
  ...
)

\method{print}{dpmirt_dp_density}(x, ...)
}
\arguments{
\item{fit}{A \code{dpmirt_fit} object with \code{prior = "dpm"}.}

\item{grid}{Numeric vector. Grid points for density evaluation.
Default: \code{seq(-6, 6, length.out = 500)}.}

\item{credible_interval}{Numeric. Width of the pointwise credible band.
Default: 0.95 (i.e., 95 percent band).}

\item{apply_rescaling}{Logical. If TRUE (default), shift the grid by the
iteration-specific location shift from post-hoc rescaling. Only
relevant for unconstrained models.}

\item{verbose}{Logical. Print progress messages. Default TRUE.}

\item{...}{Additional arguments (currently unused).}

\item{x}{A \code{dpmirt_dp_density} object.}
}
\value{
A list of class \code{dpmirt_dp_density} containing:
\describe{
\item{grid}{Numeric vector of evaluation points.}
\item{density_mean}{Numeric vector of posterior mean densities.}
\item{density_lower}{Numeric vector of lower credible band.}
\item{density_upper}{Numeric vector of upper credible band.}
\item{density_samples}{Matrix (niter x length(grid)) of per-iteration
densities (for custom summaries).}
\item{dp_samples}{List from \code{getSamplesDPmeasure()} -- each element
is a matrix with columns (weights, means, variances).}
\item{ci_level}{The credible interval level used.}
}
}
\description{
Samples from the posterior Dirichlet Process mixing distribution using
NIMBLE's \code{getSamplesDPmeasure()} and evaluates the resulting
mixture density on a grid. The density is computed by summing
weighted Normal components from the DP base measure.
}
\details{
This function follows Paganin et al.'s (2023) workflow:

\enumerate{
\item Extract posterior samples for DP parameters (alpha, zi, muTilde,
s2Tilde) from the fitted model.
\item Reconstruct a NIMBLE model and compiled MCMC with monitors set
to only DP parameters.
\item Populate the compiled MCMC's sample storage with the posterior
samples using \code{nimble:::matrix2mv()}.
\item Call \code{getSamplesDPmeasure()} to compute stick-breaking
weights and atoms for each posterior draw.
\item Evaluate the mixture density
\verb{f(x|Gs) = sum_k w_k * phi(x; mu_k, s2_k)}
for each posterior sample s and grid point x.
}

For Rasch models with unconstrained identification, a location shift
(mean(beta) per iteration) is applied so the density is on the
rescaled theta scale.
}
\examples{
\dontrun{
sim <- dpmirt_simulate(200, 20, model = "rasch",
                       latent_shape = "bimodal", seed = 42)
fit <- dpmirt(sim$response, model = "rasch", prior = "dpm",
              niter = 10000, nburnin = 3000, seed = 123)

# Compute DP density on default grid
dpd <- dpmirt_dp_density(fit)
print(dpd)

# Custom grid
dpd2 <- dpmirt_dp_density(fit, grid = seq(-4, 4, length.out = 200))
}

}
\seealso{
\code{\link{dpmirt}}, \code{\link{dpmirt_plot_dp_density}}
}
\concept{DP density}
